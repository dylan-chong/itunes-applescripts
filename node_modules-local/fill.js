const fs = require('fs');
const log = require('./header-log.js').log;

// Matches '/* @fill a-keyword */'
const FILL_REGEX = /\/\*[ ]*@fill[ ]+[^ \*]+[ ]*\*\//g;

exports.getFilledString = getFilledString;

function getFilledString(templateObject, replacementsDictionary) {
  var template = getDataFromFileContentsObject(templateObject);
  var replacements = getReplacements(replacementsDictionary);

  var splitByFillComments = template.split(FILL_REGEX);
  log('splitByFillComments', 1, splitByFillComments);
  var fillComments = template.match(FILL_REGEX);
  log('fillComments', 1, fillComments);

  // TODO fill in template

  function getDataFromFileContentsObject(object) {
    return object.contents || loadFileToString(object.path);

    function loadFileToString(filePath) {
      var contents = fs.readFileSync(filePath);
      log('loaded file "' + filePath + '"', 0, contents);
      return contents;
    }
  }

  function getReplacements(replacementsDictionary) {
    var r = {};
    for (var key in replacementsDictionary) {
      r[key] = getDataFromFileContentsObject(replacementsDictionary[key]);
    }
    return r;
  }
}

